---
layout: mypost
title: Java 反射
categories: [Java]
---



### 什么是反射？

动态语言，是指程序在运行时可以改变其结构：新的函数可以引进，已有的函数可以被删除等结构上的变化。从反射角度说 JAVA属于半动态语言。

Java 中的反射机制是指在运行状态中，对于任意一个类都能够知道这个类所有的属性和方法；并且对于任意一个对象，都能够调用它的任意一个方法；这种动态获取信息以及动态调用对象方法的功能成为 Java 语言的反射机制。

Java反射机制主要提供了以下功能：

- 在运行时判断任意一个对象所属的类。
- 在运行时构造任意一个类的对象。
- 在运行时判断任意一个类所具有的成员变量和方法。
- 在运行时调用任意一个对象的方法。 

### 反射的应用场合

1. 编译时类型和运行时类型：

   在 Java 程序中许多对象在运行是都会出现两种类型：编译时类型和运行时类型。编译时的类型由声明对象时使用的类型来决定，运行时的类型由实际赋值给对象的类型决定 。如： `Person p=new Student();`
   其中编译时类型为 `Person`，运行时类型为 `Student`。

2. 编译时类型无法获取具体方法：

   程序在运行时还可能接收到外部传入的对象，该对象的编译时类型为 Object,但是程序有需要调用该对象的运行时类型的方法。为了解决这些问题，程序需要在运行时发现对象和类的真实信息。然而，如果编译时根本无法预知该对象和类属于哪些类，程序只能依靠运行时信息来发现该对象和类的真实信息，此时就必须使用到反射了。

### Java 反射 API

反射API用来生成JVM中的类、接口或则对象的信息。

1. Class 类：反射的核心类，可以获取类的属性，方法等信息。 
2. Field 类：Java.lang.reflec 包中的类，表示类的成员变量，可以用来获取和设置类之中的属性值。
3. Method 类： Java.lang.reflec 包中的类，表示类的方法，它可以用来获取类中的方法信息或者执行方法。
4. Constructor 类： Java.lang.reflec 包中的类，表示类的构造方法。

### 反射使用步骤（获取 Class 对象、调用对象方法）

1. 获取想要操作的类的 Class 对象，他是反射的核心，通过 Class 对象我们可以任意调用类的方法。
2. 调用 Class 类中的方法，既就是反射的使用阶段。 
3. 使用反射 API 来操作这些信息。

### 获取 Class 对象的 3种方法

1. 调用某个对象的getClass()方法

   ```java
   Person p = new Person();
   Class clazz = p.getClass();
   ```

2. 调用某个类的class属性来获取该类对应的Class对象

   ```java
   Class clazz = Person.class;
   ```

3. 使用Class类中的forName()静态方法（最安全/性能最好/最常用）

   ```java
   Class clazz =Class.forName("类的全路径"); 
   ```

   

### 什么是 java 序列化？什么情况下需要序列化？

简单说就是为了保存在内存中的各种对象的状态（也就是实例变量，不是方法），并且可以把保存的对象状态再读出来。虽然你可以用你自己的各种各样的方法来保存object states，但是Java给你提供一种应该比你自己好的保存对象状态的机制，那就是序列化。

什么情况下需要序列化：

a）当你想把的内存中的对象状态保存到一个文件中或者数据库中时候；
b）当你想用套接字在网络上传送对象的时候；
c）当你想通过RMI传输对象的时候；

### 动态代理是什么？有哪些应用？

动态代理：

当想要给实现了某个接口的类中的方法，加一些额外的处理。比如说加日志，加事务等。可以给这个类创建一个代理，故名思议就是创建一个新的类，这个类不仅包含原来类方法的功能，而且还在原来的基础上添加了额外处理的新类。这个代理类并不是定义好的，是动态生成的。具有解耦意义，灵活，扩展性强。

动态代理的应用：

- Spring的AOP
- 加事务
- 加权限
- 加日志

> Reference:
>
> + https://mp.weixin.qq.com/s/QzwyYexI6v6sDb9h5tQxKA
